<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarama Sonuçları - {% if target %}{{ target }}{% else %}Xnes{% endif %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        /* Inter font for consistency */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styling for details/summary to match the dark theme and provide arrows */
        details summary::-webkit-details-marker {
            display: none; /* Hide default marker in Chrome/Safari */
        }
        details summary {
            list-style: none; /* Hide default marker in Firefox */
            position: relative; /* Needed for absolute positioning of the arrow */
            padding-left: 1.8rem; /* Space for the arrow */
        }
        details summary::before {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            content: "\f0da"; /* Font Awesome right arrow */
            position: absolute;
            left: 0.75rem; /* Adjust as needed */
            top: 50%;
            transform: translateY(-50%) rotate(0deg);
            transition: transform 0.2s ease-in-out;
            display: inline-block;
        }
        details[open] > summary::before {
            transform: translateY(-50%) rotate(90deg);
        }
        /* Custom scrollbar for pre elements in dark theme */
        pre::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        pre::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 (Tailwind v2) or similar dark */
        }
        pre::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 (Tailwind v2) or similar mid-dark */
            border-radius: 4px;
        }
        pre::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 (Tailwind v2) or similar lighter-dark */
        }
        /* Ensuring table links are visible in dark theme */
        .ffuf-results-table a {
            color: #93c5fd; /* Tailwind's blue-300 */
            text-decoration: underline;
        }
        .ffuf-results-table a:hover {
            color: #60a5fa; /* Tailwind's blue-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">
    <div class="bg-gray-800 p-6 md:p-10 rounded-xl shadow-2xl w-full max-w-5xl mx-auto" 
         data-tools='{{ tools_run|tojson|safe }}' 
         data-scan-folder="{{ scan_folder }}">
        <header class="text-center mb-10 relative">
            <button onclick="window.location.reload()" 
                    class="absolute top-0 right-0 bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-lg transition-colors duration-200">
                <i class="fas fa-sync-alt"></i>
            </button>
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-red-500">
                <i class="fas fa-poll-h mr-2"></i>Tarama Sonuçları
            </h1>
            {% if target %}
            <p class="text-gray-400 mt-3 text-lg">
                Hedef: <a href="{{ target if target.startswith('http') else 'http://' + target }}" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:text-purple-300 underline">{{ target }}</a>
            </p>
            {% endif %}
        </header>

        <!-- Scan Status Section -->
        <div id="scan-status" class="mb-8 bg-gray-800 p-4 rounded-lg">
            <h2 class="text-xl font-semibold text-gray-200 mb-4">
                <i class="fas fa-tasks mr-2 text-purple-400"></i>Tarama Durumu
            </h2>
            <div id="status-container" class="space-y-3">
                {% for tool in tools_run %}
                <div id="status-{{ tool }}" class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                    <div class="flex items-center">
                        <span class="text-lg font-medium text-gray-300 capitalize">{{ tool }}</span>
                    </div>
                    <div class="flex items-center">
                        <span class="status-badge px-3 py-1 rounded-full text-sm font-medium bg-gray-600 text-gray-300">
                            Bekleniyor...
                        </span>
                        <span class="status-time ml-3 text-sm text-gray-400"></span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <main class="space-y-8">
            {% if 'sublist3r' in tools_run and (sublist3r_stdout or sublist3r_stderr) %}
            <div class="result-section bg-gray-700/50 p-5 md:p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-3">
                    <h2 class="text-xl md:text-2xl font-semibold text-gray-200">
                        <i class="fab fa-searchengin mr-2 text-purple-400"></i>Sublist3r Sonuçları
                    </h2>
                    <button onclick="downloadResults('sublist3r')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                        <i class="fas fa-download mr-2"></i>İndir
                    </button>
                </div>
                
                {% if sublist3r_stdout %}
                <div id="sublist3r_parsed_subdomains" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Subdomainler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"></pre>
                </div>
                <details class="bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Standart Çıktı (stdout)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre id="sublist3r_full_stdout" class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ sublist3r_stdout }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if sublist3r_stderr %}
                <details class="mt-4 bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                         Hata Çıktısı (stderr)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ sublist3r_stderr }}</pre>
                    </div>
                </details>
                {% endif %}
                
                {% if not sublist3r_stdout and not sublist3r_stderr %}
                    <p class="text-gray-400"><i class="fas fa-info-circle mr-1 text-blue-400"></i>Sublist3r için gösterilecek sonuç veya çıktı bulunmamaktadır.</p>
                {% endif %}
            </div>
            {% endif %}

            {% if 'subdomainizer' in tools_run and (subdomainizer_stdout or subdomainizer_stderr) %}
            <div class="result-section bg-gray-700/50 p-5 md:p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-4 border-b border-gray-600 pb-3">
                    <h2 class="text-xl md:text-2xl font-semibold text-gray-200">
                        <i class="fas fa-code-branch mr-2 text-pink-500"></i>SubDomainizer Sonuçları
                    </h2>
                    <button onclick="downloadResults('subdomainizer')" class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                        <i class="fas fa-download mr-2"></i>İndir
                    </button>
                </div>

                {% if subdomainizer_cloudurls and subdomainizer_cloudurls|length > 0 %}
                <div class="mb-4">
                    <h3 class="text-lg font-medium text-blue-300 mb-2">Bulunan Cloud Servis URL'leri:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar">{{ subdomainizer_cloudurls|join('\n') }}</pre>
                </div>
                {% endif %}


                {% if subdomainizer_stdout %}
                <div id="subdomainizer_parsed_subdomains" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Subdomainler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"></pre>
                </div>
                <div id="subdomainizer_parsed_secrets" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Secretler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"></pre>
                </div>
                
                <details class="bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Standart Çıktı (stdout)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre id="subdomainizer_full_stdout" class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ subdomainizer_stdout }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if subdomainizer_stderr %}
                <details class="mt-4 bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Hata Çıktısı (stderr)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ subdomainizer_stderr }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if not subdomainizer_stdout and not subdomainizer_stderr %}
                    <p class="text-gray-400"><i class="fas fa-info-circle mr-1 text-blue-400"></i>SubDomainizer için gösterilecek sonuç veya çıktı bulunmamaktadır.</p>
                {% endif %}
            </div>
            {% endif %}
            
            {% if 'ffuf' in tools_run and (ffuf_json_parsed is not none or ffuf_json_raw or ffuf_stderr) %}
            <div class="result-section bg-gray-700/50 p-6 rounded-lg shadow-lg mb-8">
                <details class="bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-semibold text-gray-200 inline-flex items-center">
                                <i class="fas fa-folder-open mr-2 text-red-500"></i>FFUF Sonuçları
                            </h2>
                            <button onclick="event.stopPropagation(); downloadResults('ffuf')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                                <i class="fas fa-download mr-2"></i>İndir
                            </button>
                        </div>
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        {% if ffuf_json_parsed is not none and ffuf_json_parsed %}
                            <div class="mb-4">
                                <h3 class="text-lg font-medium text-gray-300 mb-3">Bulunan Yollar:</h3>
                                <div class="overflow-x-auto rounded-md shadow">
                                    <table class="ffuf-results-table w-full text-sm text-left text-gray-300 bg-gray-800">
                                        <thead class="text-xs text-gray-200 uppercase bg-gray-700">
                                            <tr>
                                                <th scope="col" class="px-6 py-3">URL</th>
                                                <th scope="col" class="px-6 py-3">Durum</th>
                                                <th scope="col" class="px-6 py-3">Uzunluk</th>
                                                <th scope="col" class="px-6 py-3">Kelimeler</th>
                                                <th scope="col" class="px-6 py-3">Satırlar</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ffuf-results-body" data-results='{{ ffuf_json_parsed|tojson|safe if ffuf_json_parsed else "[]" }}'>
                                            <!-- Results will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div id="ffuf-pagination" class="mt-4 flex justify-between items-center">
                                    <div class="text-sm text-gray-400">
                                        Toplam <span id="ffuf-total-count">0</span> sonuç
                                    </div>
                                    <div class="flex space-x-2">
                                        <button id="ffuf-prev-page" class="px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <i class="fas fa-chevron-left"></i> Önceki
                                        </button>
                                        <span id="ffuf-page-info" class="px-3 py-1 text-gray-300">Sayfa 1</span>
                                        <button id="ffuf-next-page" class="px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                                            Sonraki <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% elif ffuf_json_parsed is none and ffuf_json_raw %}
                            <div id="ffuf-progress" class="mb-4 p-4 bg-gray-800 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-medium text-gray-300">Tarama Devam Ediyor...</h3>
                                    <span class="text-sm text-gray-400" id="ffuf-time-elapsed">0:00</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2.5">
                                    <div class="bg-purple-600 h-2.5 rounded-full animate-pulse" style="width: 100%"></div>
                                </div>
                                <p class="mt-2 text-sm text-gray-400">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    FFUF taraması devam ediyor. Bu işlem büyük kelime listeleri için 30 dakikaya kadar sürebilir.
                                </p>
                            </div>
                            <h3 class="text-lg font-medium text-gray-300 mb-2">JSON Çıktısı (Ham Veri):</h3>
                            <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ ffuf_json_raw if ffuf_json_raw.strip() else "FFUF JSON çıktısı yok veya işlenemedi." }}</pre>
                        {% else %}
                            <p class="text-gray-400 my-4"><i class="fas fa-info-circle mr-1 text-blue-400"></i>FFUF ile herhangi bir yol bulunamadı veya filtrelere uyan sonuç yok.</p>
                            {% if ffuf_json_raw %}
                            <h3 class="text-lg font-medium text-gray-300 mb-2">JSON Çıktısı (Ham Veri):</h3>
                            <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ ffuf_json_raw if ffuf_json_raw.strip() else "FFUF JSON çıktısı boş." }}</pre>
                            {% endif %}
                        {% endif %}

                        {% if ffuf_stderr %}
                        <details class="mt-6 bg-gray-700 rounded-md shadow-inner">
                            <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                                Konsol Hata Çıktısı (stderr):
                            </summary>
                            <div class="p-3 border-t border-gray-600">
                                <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ ffuf_stderr if ffuf_stderr.strip() else "FFUF için konsol hata çıktısı yok." }}</pre>
                            </div>
                        </details>
                        {% endif %}
                    </div>
                </details>
            </div>
            {% endif %}
            </main>

        <footer class="mt-12 text-center">
            <div class="flex justify-center space-x-4 mb-8">
                <button onclick="downloadAllResults()" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">
                    <i class="fas fa-download mr-2"></i>Tüm Sonuçları İndir
                </button>
                <a href="{{ url_for('index') }}"
                   class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">
                    <i class="fas fa-arrow-left mr-2"></i>Yeni Tarama Başlat
                </a>
                {% if GEMINI_API_KEY_AVAILABLE %}
                <a href="{{ url_for('ai_chat_page', scan_folder=scan_folder) }}"
                   class="inline-block bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-teal-500">
                    <i class="fas fa-robot mr-2"></i>AI ile Tartış
                </a>
                {% endif %}
            </div>
            <p class="text-gray-500 mt-8 pb-4">&copy; 2025 Xnes. Tüm hakları saklıdır.</p>
        </footer>
    </div>
{% raw %}
    <script>
        // Global download functions
        function downloadResults(tool) {
            let content = '';
            let filename = '';

            switch(tool) {
                case 'sublist3r':
                    const sublist3rPre = document.querySelector('#sublist3r_parsed_subdomains pre');
                    content = sublist3rPre ? sublist3rPre.textContent : '';
                    filename = 'sublist3r_results.txt';
                    break;
                case 'subdomainizer':
                    const subdomainsPre = document.querySelector('#subdomainizer_parsed_subdomains pre');
                    const secretsPre = document.querySelector('#subdomainizer_parsed_secrets pre');
                    content = '=== Subdomains ===\n' + (subdomainsPre ? subdomainsPre.textContent : '') + 
                            '\n\n=== Secrets ===\n' + (secretsPre ? secretsPre.textContent : '');
                    filename = 'subdomainizer_results.txt';
                    break;
                case 'ffuf':
                    const ffufResults = JSON.parse(document.getElementById('ffuf-results-body').dataset.results || '[]');
                    content = JSON.stringify(ffufResults, null, 2);
                    filename = 'ffuf_results.json';
                    break;
            }

            if (content) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }
        }

        function downloadAllResults() {
            const tools = ['sublist3r', 'subdomainizer', 'ffuf'];
            const zip = new JSZip();
            
            tools.forEach(tool => {
                let content = '';
                let filename = '';

                switch(tool) {
                    case 'sublist3r':
                        const sublist3rPre = document.querySelector('#sublist3r_parsed_subdomains pre');
                        content = sublist3rPre ? sublist3rPre.textContent : '';
                        filename = 'sublist3r_results.txt';
                        break;
                    case 'subdomainizer':
                        const subdomainsPre = document.querySelector('#subdomainizer_parsed_subdomains pre');
                        const secretsPre = document.querySelector('#subdomainizer_parsed_secrets pre');
                        content = '=== Subdomains ===\n' + (subdomainsPre ? subdomainsPre.textContent : '') + 
                                '\n\n=== Secrets ===\n' + (secretsPre ? secretsPre.textContent : '');
                        filename = 'subdomainizer_results.txt';
                        break;
                    case 'ffuf':
                        const ffufResults = JSON.parse(document.getElementById('ffuf-results-body').dataset.results || '[]');
                        content = JSON.stringify(ffufResults, null, 2);
                        filename = 'ffuf_results.json';
                        break;
                }

                if (content) {
                    zip.file(filename, content);
                }
            });

            zip.generateAsync({type: 'blob'}).then(function(content) {
                const url = window.URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'scan_results.zip';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.bg-gray-800');
            const scanFolder = container.dataset.scanFolder;
            const tools = JSON.parse(container.dataset.tools || '[]');
            let allToolsCompleted = false;

            // Immediately process results when page loads
            if (document.getElementById('sublist3r_full_stdout')) {
                parseSublist3rResults();
            }
            if (document.getElementById('subdomainizer_full_stdout')) {
                parseSubDomainizerResults();
            }

            function parseSublist3rResults() {
                const sublist3rStdout = document.getElementById('sublist3r_full_stdout');
                const sublist3rParsedContainer = document.getElementById('sublist3r_parsed_subdomains');
                
                if (sublist3rStdout && sublist3rParsedContainer) {
                    try {
                        const content = sublist3rStdout.textContent;
                        const lines = content.split('\n');
                        const subdomains = new Set();

                        for (const line of lines) {
                            const trimmedLine = line.trim();
                            if (!trimmedLine || trimmedLine.startsWith('[') || trimmedLine.startsWith('Exception')) {
                                continue;
                            }
                            if (trimmedLine.includes('.') && !trimmedLine.includes(' ') && 
                                !trimmedLine.startsWith('http') && !trimmedLine.startsWith('www')) {
                                subdomains.add(trimmedLine);
                            }
                        }

                        const subdomainsPre = sublist3rParsedContainer.querySelector('pre');
                        if (subdomains.size > 0) {
                            subdomainsPre.textContent = Array.from(subdomains).join('\n');
                        } else {
                            subdomainsPre.innerHTML = '<i>Bu araçla subdomain bulunamadı. Çıktıda geçerli bir subdomain formatı bulunamadı.</i>';
                        }
                    } catch (error) {
                        const subdomainsPre = sublist3rParsedContainer.querySelector('pre');
                        subdomainsPre.innerHTML = `<i>Sonuçlar ayrıştırılamadı. Hata: ${error.message}</i>`;
                    }
                }
            }

            function parseSubDomainizerResults() {
                const subdomainizerStdout = document.getElementById('subdomainizer_full_stdout');
                const subdomainsContainer = document.getElementById('subdomainizer_parsed_subdomains');
                const secretsContainer = document.getElementById('subdomainizer_parsed_secrets');
                
                if (subdomainizerStdout && subdomainsContainer && secretsContainer) {
                    try {
                        const content = subdomainizerStdout.textContent;
                        const lines = content.split('\n');
                        const subdomains = new Set();
                        const secrets = new Set();
                        let inSubdomains = false;
                        let inSecrets = false;

                        for (const line of lines) {
                            const trimmedLine = line.trim();
                            
                            if (trimmedLine.includes('Got some subdomains...')) {
                                inSubdomains = true;
                                inSecrets = false;
                                continue;
                            }
                            if (trimmedLine.includes('Found some secrets')) {
                                inSecrets = true;
                                inSubdomains = false;
                                continue;
                            }
                            if (trimmedLine.includes('End of Results')) {
                                inSubdomains = false;
                                inSecrets = false;
                                continue;
                            }

                            if (inSubdomains && trimmedLine && !trimmedLine.startsWith('Total Subdomains:')) {
                                if (trimmedLine.includes('.') && !trimmedLine.includes(' ')) {
                                    subdomains.add(trimmedLine);
                                }
                            } else if (inSecrets && trimmedLine && !trimmedLine.startsWith('Total Secrets:')) {
                                secrets.add(trimmedLine);
                            }
                        }

                        const subdomainsPre = subdomainsContainer.querySelector('pre');
                        if (subdomains.size > 0) {
                            subdomainsPre.textContent = Array.from(subdomains).join('\n');
                        } else {
                            subdomainsPre.innerHTML = '<i>Bu araçla subdomain bulunamadı. Çıktıda geçerli bir subdomain formatı bulunamadı.</i>';
                        }

                        const secretsPre = secretsContainer.querySelector('pre');
                        if (secrets.size > 0) {
                            secretsPre.textContent = Array.from(secrets).join('\n');
                        } else {
                            secretsPre.innerHTML = '<i>Bu araçla secret bulunamadı. Çıktıda geçerli bir secret formatı bulunamadı.</i>';
                        }
                    } catch (error) {
                        const subdomainsPre = subdomainsContainer.querySelector('pre');
                        const secretsPre = secretsContainer.querySelector('pre');
                        subdomainsPre.innerHTML = `<i>Sonuçlar ayrıştırılamadı. Hata: ${error.message}</i>`;
                        secretsPre.innerHTML = `<i>Sonuçlar ayrıştırılamadı. Hata: ${error.message}</i>`;
                    }
                }
            }

            function updateStatusDisplay(tool, status, message, time) {
                const statusDiv = document.getElementById(`status-${tool}`);
                if (!statusDiv) return;

                const statusBadge = statusDiv.querySelector('.status-badge');
                const timeSpan = statusDiv.querySelector('.status-time');
                
                statusBadge.textContent = status;
                statusBadge.className = 'status-badge px-3 py-1 rounded-full text-sm font-medium';
                
                if (status === 'Tamamlandı') {
                    statusBadge.classList.add('bg-green-600', 'text-white');
                } else if (status === 'Hata' || status === 'Zaman Aşımı') {
                    statusBadge.classList.add('bg-red-600', 'text-white');
                } else if (status === 'Çalışıyor...') {
                    statusBadge.classList.add('bg-blue-600', 'text-white');
                } else {
                    statusBadge.classList.add('bg-gray-600', 'text-gray-300');
                }

                if (time) {
                    timeSpan.textContent = time;
                }
            }

            function checkScanStatus() {
                fetch(`/scan_status/${scanFolder}`)
                    .then(response => response.json())
                    .then(data => {
                        let completedCount = 0;
                        
                        for (const tool of tools) {
                            const toolStatus = data[tool];
                            if (toolStatus) {
                                updateStatusDisplay(
                                    tool,
                                    toolStatus.status,
                                    toolStatus.message,
                                    toolStatus.last_update
                                );
                                
                                if (toolStatus.status === 'Tamamlandı' || 
                                    toolStatus.status === 'Hata' || 
                                    toolStatus.status === 'Zaman Aşımı') {
                                    completedCount++;
                                }
                            }
                        }

                        if (completedCount === tools.length && !allToolsCompleted) {
                            allToolsCompleted = true;
                            clearInterval(statusInterval);
                        }
                    })
                    .catch(error => console.error('Error checking scan status:', error));
            }

            // Check status every 2 seconds
            const statusInterval = setInterval(checkScanStatus, 2000);
            
            // Initial check
            checkScanStatus();

            // Clean up interval when page is unloaded
            window.addEventListener('beforeunload', () => {
                clearInterval(statusInterval);
            });

            // FFUF results pagination
            const ITEMS_PER_PAGE = 50;
            let currentPage = 1;
            let ffufResults = [];

            function loadFFUFResults() {
                const results = JSON.parse(document.getElementById('ffuf-results-body').dataset.results || '[]');
                ffufResults = results;
                const totalPages = Math.ceil(results.length / ITEMS_PER_PAGE);
                
                document.getElementById('ffuf-total-count').textContent = results.length;
                document.getElementById('ffuf-prev-page').disabled = currentPage === 1;
                document.getElementById('ffuf-next-page').disabled = currentPage === totalPages;
                document.getElementById('ffuf-page-info').textContent = `Sayfa ${currentPage} / ${totalPages}`;
                
                const start = (currentPage - 1) * ITEMS_PER_PAGE;
                const end = start + ITEMS_PER_PAGE;
                const pageResults = results.slice(start, end);
                
                const tbody = document.getElementById('ffuf-results-body');
                tbody.innerHTML = pageResults.map(result => `
                    <tr class="bg-gray-800 border-b border-gray-700 hover:bg-gray-700/70">
                        <td class="px-6 py-4 font-medium whitespace-nowrap">
                            <a href="${result.url}" target="_blank" rel="noopener noreferrer">${result.url}</a>
                        </td>
                        <td class="px-6 py-4">${result.status}</td>
                        <td class="px-6 py-4">${result.length}</td>
                        <td class="px-6 py-4">${result.words}</td>
                        <td class="px-6 py-4">${result.lines}</td>
                    </tr>
                `).join('');
            }

            document.getElementById('ffuf-prev-page')?.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadFFUFResults();
                }
            });

            document.getElementById('ffuf-next-page')?.addEventListener('click', () => {
                const totalPages = Math.ceil(ffufResults.length / ITEMS_PER_PAGE);
                if (currentPage < totalPages) {
                    currentPage++;
                    loadFFUFResults();
                }
            });

            // Initial load of FFUF results
            if (document.getElementById('ffuf-results-body')) {
                loadFFUFResults();
            }
        });
    </script>
{% endraw %}
</body>
</html>
