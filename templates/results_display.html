<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarama Sonuçları - {% if target %}{{ target }}{% else %}Xnes{% endif %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Inter font for consistency */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styling for details/summary to match the dark theme and provide arrows */
        details summary::-webkit-details-marker {
            display: none; /* Hide default marker in Chrome/Safari */
        }
        details summary {
            list-style: none; /* Hide default marker in Firefox */
            position: relative; /* Needed for absolute positioning of the arrow */
            padding-left: 1.8rem; /* Space for the arrow */
        }
        details summary::before {
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            content: "\f0da"; /* Font Awesome right arrow */
            position: absolute;
            left: 0.75rem; /* Adjust as needed */
            top: 50%;
            transform: translateY(-50%) rotate(0deg);
            transition: transform 0.2s ease-in-out;
            display: inline-block;
        }
        details[open] > summary::before {
            transform: translateY(-50%) rotate(90deg);
        }
        /* Custom scrollbar for pre elements in dark theme */
        pre::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        pre::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 (Tailwind v2) or similar dark */
        }
        pre::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 (Tailwind v2) or similar mid-dark */
            border-radius: 4px;
        }
        pre::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 (Tailwind v2) or similar lighter-dark */
        }
        /* Ensuring table links are visible in dark theme */
        .ffuf-results-table a {
            color: #93c5fd; /* Tailwind's blue-300 */
            text-decoration: underline;
        }
        .ffuf-results-table a:hover {
            color: #60a5fa; /* Tailwind's blue-400 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">
    <div class="bg-gray-800 p-6 md:p-10 rounded-xl shadow-2xl w-full max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-red-500">
                <i class="fas fa-poll-h mr-2"></i>Tarama Sonuçları
            </h1>
            {% if target %}
            <p class="text-gray-400 mt-3 text-lg">
                Hedef: <a href="{{ target if target.startswith('http') else 'http://' + target }}" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:text-purple-300 underline">{{ target }}</a>
            </p>
            {% endif %}
        </header>

        <main class="space-y-8">
            {% if sublist3r_stdout or sublist3r_stderr %}
            <div class="result-section bg-gray-700/50 p-5 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-200 mb-4 border-b border-gray-600 pb-3">
                    <i class="fab fa-searchengin mr-2 text-purple-400"></i>Sublist3r Sonuçları
                </h2>
                
                {% if sublist3r_stdout %}
                <div id="sublist3r_parsed_subdomains" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Subdomainler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"><i>İşleniyor...</i></pre>
                </div>
                <details class="bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Standart Çıktı (stdout)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre id="sublist3r_full_stdout" class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ sublist3r_stdout }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if sublist3r_stderr %}
                <details class="mt-4 bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                         Hata Çıktısı (stderr)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ sublist3r_stderr }}</pre>
                    </div>
                </details>
                {% endif %}
                
                {% if not sublist3r_stdout and not sublist3r_stderr %}
                    <p class="text-gray-400"><i class="fas fa-info-circle mr-1 text-blue-400"></i>Sublist3r için gösterilecek sonuç veya çıktı bulunmamaktadır.</p>
                {% endif %}
            </div>
            {% endif %}

            {% if subdomainizer_stdout or subdomainizer_stderr %}
            <div class="result-section bg-gray-700/50 p-5 md:p-6 rounded-lg shadow-lg">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-200 mb-4 border-b border-gray-600 pb-3">
                    <i class="fas fa-code-branch mr-2 text-pink-500"></i>SubDomainizer Sonuçları
                </h2>

                {% if subdomainizer_stdout %}
                <div id="subdomainizer_parsed_subdomains" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Subdomainler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"><i>İşleniyor...</i></pre>
                </div>
                <div id="subdomainizer_parsed_secrets" class="parsed-content-container mb-4">
                    <h3 class="text-lg font-medium text-gray-300 mb-2">Bulunan Secretler:</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-80 custom-scrollbar"><i>İşleniyor...</i></pre>
                </div>
                <details class="bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Standart Çıktı (stdout)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre id="subdomainizer_full_stdout" class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ subdomainizer_stdout }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if subdomainizer_stderr %}
                <details class="mt-4 bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Hata Çıktısı (stderr)
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                        <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ subdomainizer_stderr }}</pre>
                    </div>
                </details>
                {% endif %}

                {% if not subdomainizer_stdout and not subdomainizer_stderr %}
                    <p class="text-gray-400"><i class="fas fa-info-circle mr-1 text-blue-400"></i>SubDomainizer için gösterilecek sonuç veya çıktı bulunmamaktadır.</p>
                {% endif %}
            </div>
            {% endif %}
            
            {% if ffuf_json_parsed is not none or ffuf_json_raw or ffuf_stderr %}
            <div class="result-section bg-gray-700/50 p-6 rounded-lg shadow-lg mb-8">
                <h2 class="text-2xl font-semibold text-gray-200 mb-4 border-b border-gray-600 pb-2">
                    <i class="fas fa-folder-open mr-2 text-red-500"></i>FFUF Sonuçları
                </h2>
                {% if ffuf_json_parsed is not none and ffuf_json_parsed %} {# Assuming ffuf_json_parsed is the list of results #}
                    <h3 class="text-lg font-medium text-gray-300 mb-3">Bulunan Yollar:</h3>
                    <div class="overflow-x-auto rounded-md shadow">
                        <table class="ffuf-results-table w-full text-sm text-left text-gray-300 bg-gray-800">
                            <thead class="text-xs text-gray-200 uppercase bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3">URL</th>
                                    <th scope="col" class="px-6 py-3">Durum</th>
                                    <th scope="col" class="px-6 py-3">Uzunluk</th>
                                    <th scope="col" class="px-6 py-3">Kelimeler</th>
                                    <th scope="col" class="px-6 py-3">Satırlar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in ffuf_json_parsed %} {# Iterate directly if it's a list #}
                                <tr class="bg-gray-800 border-b border-gray-700 hover:bg-gray-700/70">
                                    <td class="px-6 py-4 font-medium whitespace-nowrap">
                                        <a href="{{ result.url }}" target="_blank" rel="noopener noreferrer">{{ result.url }}</a>
                                    </td>
                                    <td class="px-6 py-4">{{ result.status }}</td>
                                    <td class="px-6 py-4">{{ result.length }}</td>
                                    <td class="px-6 py-4">{{ result.words }}</td>
                                    <td class="px-6 py-4">{{ result.lines }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% elif ffuf_json_parsed is none and ffuf_json_raw %}
                    <h3 class="text-lg font-medium text-gray-300 mb-2">JSON Çıktısı (Ham Veri):</h3>
                    <p class="text-sm text-yellow-400 mb-2"><i class="fas fa-exclamation-triangle mr-1"></i>JSON verisi işlenirken bir sorun oluştu veya dosya bulunamadı. Ham veri aşağıdadır:</p>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ ffuf_json_raw if ffuf_json_raw.strip() else "FFUF JSON çıktısı yok veya işlenemedi." }}</pre>
                {% else %} {# Covers ffuf_json_parsed is not None but empty, or no data at all #}
                    <p class="text-gray-400 my-4"><i class="fas fa-info-circle mr-1 text-blue-400"></i>FFUF ile herhangi bir yol bulunamadı veya filtrelere uyan sonuç yok.</p>
                    {% if ffuf_json_raw %}
                    <h3 class="text-lg font-medium text-gray-300 mb-2">JSON Çıktısı (Ham Veri):</h3>
                    <pre class="bg-gray-800 p-4 rounded-md overflow-x-auto text-sm max-h-96 custom-scrollbar">{{ ffuf_json_raw if ffuf_json_raw.strip() else "FFUF JSON çıktısı boş." }}</pre>
                    {% endif %}
                {% endif %}

                {% if ffuf_stderr %}
                <details class="mt-6 bg-gray-700 rounded-md shadow-inner">
                    <summary class="cursor-pointer p-3 font-medium text-gray-300 hover:bg-gray-600/70 rounded-t-md">
                        Konsol Hata Çıktısı (stderr):
                    </summary>
                    <div class="p-3 border-t border-gray-600">
                         <pre class="bg-gray-800 p-4 rounded-b-md overflow-x-auto text-sm max-h-60 custom-scrollbar">{{ ffuf_stderr if ffuf_stderr.strip() else "FFUF için konsol hata çıktısı yok." }}</pre>
                    </div>
                </details>
                {% endif %}
                 {% if not ffuf_json_parsed and not ffuf_json_raw and not ffuf_stderr %}
                    <p class="text-gray-400"><i class="fas fa-info-circle mr-1 text-blue-400"></i>FFUF için gösterilecek sonuç veya çıktı bulunmamaktadır.</p>
                {% endif %}
            </div>
            {% endif %}
            </main>

        <footer class="mt-12 text-center">
            <a href="{{ url_for('index') }}"
               class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">
                <i class="fas fa-arrow-left mr-2"></i>Yeni Tarama Başlat
            </a>
            <p class="text-gray-500 mt-8 pb-4">&copy; 2025 Xnes. Tüm hakları saklıdır.</p>
        </footer>
    </div>
{% raw %}
    <script>
        // JavaScript for parsing and displaying extracted data
        // Wait for the DOM to be fully loaded before running scripts
        document.addEventListener('DOMContentLoaded', () => {
            
            /**
             * Parses Sublist3r stdout to extract subdomains.
             * @param {string} stdoutText - The raw stdout string from Sublist3r.
             * @returns {string[]} An array of found subdomains.
             */
            function parseSublist3rStdout(stdoutText) {
                if (!stdoutText) return [];
                const lines = stdoutText.split('\n');
                const subdomains = [];
                const marker = "[-] Total Unique Subdomains Found:";
                let foundMarker = false;

                for (const line of lines) {
                    if (line.includes(marker)) {
                        foundMarker = true;
                        continue; // Skip the marker line itself
                    }
                    if (foundMarker) {
                        const trimmedLine = line.trim();
                        // Filter out potential noise or empty lines after subdomains list
                        if (trimmedLine && !trimmedLine.startsWith("[") && !trimmedLine.startsWith("-") && !trimmedLine.startsWith("#") && trimmedLine.includes('.')) {
                            // Further check to avoid lines that are clearly not just subdomains
                            if (trimmedLine.split(" ").length === 1 && trimmedLine.match(/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)) {
                                subdomains.push(trimmedLine);
                            }
                        } else if (trimmedLine.startsWith("[")) { 
                            // If we encounter another status line from Sublist3r, stop parsing subdomains.
                            // This helps if there's trailing output after the subdomain list.
                            break;
                        }
                    }
                }
                return subdomains;
            }

            /**
             * Parses SubDomainizer stdout to extract subdomains and secrets.
             * @param {string} stdoutText - The raw stdout string from SubDomainizer.
             * @returns {{subdomains: string[], secrets: string[]}} An object containing arrays of subdomains and secrets.
             */
            function parseSubDomainizerStdout(stdoutText) {
                if (!stdoutText) return { subdomains: [], secrets: [] };
                const lines = stdoutText.split('\n');
                const subdomains = [];
                const secrets = [];
                let readingSubdomains = false;
                let readingSecrets = false;

                const subdomainsHeaderMarker = "Got some subdomains..."; // Actual header before list
                const subdomainsStartMarker = "Total Subdomains:"; // Line indicating count, often before the actual list starts or after a block
                const subdomainsEndMarker = /____________________________________________________________|Found some secrets\(might be false positive\)|\[\*\] Searching for Inline Javascripts.../; // End of subdomains block or start of next significant block

                const secretsHeaderMarker = "Found some secrets(might be false positive)..."; // Actual header
                const secretsStartMarker = "Total Possible Secrets:"; // Line indicating count
                const secretsEndMarker = /_______________________End of Results_______________________/; // End of secrets block

                for (const line of lines) {
                    const trimmedLine = line.trim();

                    if (line.includes(subdomainsHeaderMarker) || line.includes(subdomainsStartMarker)) {
                        readingSubdomains = true;
                        readingSecrets = false; 
                        continue; 
                    }
                    if (line.includes(secretsHeaderMarker) || line.includes(secretsStartMarker)) {
                        readingSecrets = true;
                        readingSubdomains = false; 
                        continue;
                    }

                    if (readingSubdomains) {
                        if (subdomainsEndMarker.test(line)) {
                            readingSubdomains = false;
                        } else if (trimmedLine && !trimmedLine.startsWith("Total Subdomains:") && trimmedLine.includes('.') && !trimmedLine.startsWith("http") && !trimmedLine.includes(" ")) {
                            // More specific check for subdomain format
                             if (trimmedLine.match(/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)) {
                                subdomains.push(trimmedLine);
                            }
                        }
                    } else if (readingSecrets) {
                        if (secretsEndMarker.test(line)) {
                            readingSecrets = false;
                        } else if (trimmedLine && !trimmedLine.startsWith("Total Possible Secrets:")) {
                            secrets.push(trimmedLine);
                        }
                    }
                }
                // Remove duplicates that might arise from parsing logic
                return { 
                    subdomains: [...new Set(subdomains)], 
                    secrets: [...new Set(secrets)] 
                };
            }

            // Process Sublist3r Output
            const sublist3rFullStdoutPre = document.getElementById('sublist3r_full_stdout');
            if (sublist3rFullStdoutPre) {
                const sublist3rStdoutText = sublist3rFullStdoutPre.textContent;
                const sublist3rParsedSubdomainsContainer = document.getElementById('sublist3r_parsed_subdomains');
                if (sublist3rParsedSubdomainsContainer) {
                    const sublist3rSubdomains = parseSublist3rStdout(sublist3rStdoutText);
                    const subdomainsPre = sublist3rParsedSubdomainsContainer.querySelector('pre');
                    if (sublist3rSubdomains.length > 0) {
                        subdomainsPre.textContent = sublist3rSubdomains.join('\n');
                    } else {
                        subdomainsPre.innerHTML = '<i>Bu araçla subdomain bulunamadı veya çıktı ayrıştırılamadı. Tam çıktıya göz atın.</i>';
                    }
                }
            } else {
                const sublist3rParsedContainer = document.getElementById('sublist3r_parsed_subdomains');
                if (sublist3rParsedContainer && sublist3rParsedContainer.querySelector('pre').innerHTML.includes('İşleniyor...')) {
                     sublist3rParsedContainer.querySelector('pre').innerHTML = '<i>Sublist3r standart çıktısı bulunmuyor.</i>';
                }
            }

            // Process SubDomainizer Output
            const subdomainizerFullStdoutPre = document.getElementById('subdomainizer_full_stdout');
            if (subdomainizerFullStdoutPre) {
                const subdomainizerStdoutText = subdomainizerFullStdoutPre.textContent;
                const { subdomains: sdSubdomains, secrets: sdSecrets } = parseSubDomainizerStdout(subdomainizerStdoutText);

                const subdomainizerParsedSubdomainsContainer = document.getElementById('subdomainizer_parsed_subdomains');
                if (subdomainizerParsedSubdomainsContainer) {
                    const subdomainsPre = subdomainizerParsedSubdomainsContainer.querySelector('pre');
                    if (sdSubdomains.length > 0) {
                        subdomainsPre.textContent = sdSubdomains.join('\n');
                    } else {
                        subdomainsPre.innerHTML = '<i>Bu araçla subdomain bulunamadı veya çıktı ayrıştırılamadı. Tam çıktıya göz atın.</i>';
                    }
                }

                const subdomainizerParsedSecretsContainer = document.getElementById('subdomainizer_parsed_secrets');
                if (subdomainizerParsedSecretsContainer) {
                    const secretsPre = subdomainizerParsedSecretsContainer.querySelector('pre');
                    if (sdSecrets.length > 0) {
                        secretsPre.textContent = sdSecrets.join('\n');
                    } else {
                        secretsPre.innerHTML = '<i>Bu araçla secret bulunamadı veya çıktı ayrıştırılamadı. Tam çıktıya göz atın.</i>';
                    }
                }
            } else {
                const sdParsedDomainsContainer = document.getElementById('subdomainizer_parsed_subdomains');
                if (sdParsedDomainsContainer && sdParsedDomainsContainer.querySelector('pre').innerHTML.includes('İşleniyor...')) {
                     sdParsedDomainsContainer.querySelector('pre').innerHTML = '<i>SubDomainizer alan adı çıktısı bulunmuyor.</i>';
                }
                const sdParsedSecretsContainer = document.getElementById('subdomainizer_parsed_secrets');
                 if (sdParsedSecretsContainer && sdParsedSecretsContainer.querySelector('pre').innerHTML.includes('İşleniyor...')) {
                     sdParsedSecretsContainer.querySelector('pre').innerHTML = '<i>SubDomainizer secret çıktısı bulunmuyor.</i>';
                }
            }
        });
    </script>
{% endraw %}
</body>
</html>
